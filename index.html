<!DOCTYPE html>
<html lang="en">

<!-- Inscribe Editor v2 by Mark Yu -->

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Inscribe Editor</title>
<link rel="icon" type="image/svg+xml" href="assets/favicon/favicon.svg" />
<link rel="icon" type="image/png" sizes="96x96" href="assets/favicon/favicon-96x96.png" />
<link rel="shortcut icon" href="assets/favicon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png" />
<link rel="manifest" href="assets/favicon/site.webmanifest" />
<meta name="theme-color" content="#2563eb" />

<!-- Local fonts -->
<link rel="stylesheet" href="assets/fonts/fonts.css"/>

<!-- CodeMirror -->
<link rel="stylesheet" href="assets/vendor/codemirror/codemirror.min.css"/>
<link rel="stylesheet" href="assets/vendor/codemirror/eclipse.min.css"/>

<!-- App styles -->
<link rel="stylesheet" href="assets/css/app.css"/>

<!-- Pyodide + CodeMirror scripts -->
<script defer data-cfasync="false" src="assets/vendor/pyodide/pyodide.js"></script>
<script defer data-cfasync="false" src="assets/vendor/codemirror/codemirror.min.js"></script>
<script defer data-cfasync="false" src="assets/vendor/codemirror/python.min.js"></script>

<style id="dynamicStyles"></style>
</head>

<body>
  <div class="loadingOverlay" id="loadingOverlay" role="status" aria-live="polite" aria-label="Loading editor">
    <div class="loadingCard">
      <div class="loadingSpinner" aria-hidden="true"></div>
      <div class="loadingText">Loading editor…</div>
    </div>
  </div>
  <div class="app">
    <header>
      <div class="headerInner">
        <div class="brand">
          <span class="material-icons" aria-hidden="true">code</span>
          <div class="brandText">
            <h1>Inscribe Editor</h1>
            <div class="sub">In-browser Python editor and executor.</div>
          </div>
        </div>

        <div class="toolbar">
          <!-- Run split button + config menu -->
          <div class="runGroup menuWrap" id="runGroup">
            <button class="toolBtn primary" id="runBtn" type="button" title="Run All (Cmd/Ctrl + Enter)">
              <span class="material-icons" aria-hidden="true">play_arrow</span>
              <span class="toolLabel" id="runLabel" style="opacity:1; transform:none;">Run All</span>

              <!-- Shortcut pill only -->
              <span class="runMeta">
                <span class="keyChip" id="hintRun">Ctrl Enter</span>
              </span>
            </button>

            <button class="toolBtn primary" id="runModeBtn" type="button" title="Run options"
              aria-haspopup="menu" aria-expanded="false">
              <span class="material-icons" aria-hidden="true">arrow_drop_down</span>
            </button>

            <div class="menu" id="runMenu" role="menu" aria-label="Run options">
              <button class="menuItem" id="runAllBtn" type="button" role="menuitem">
                <span class="material-icons" aria-hidden="true">description</span>
                <span class="miLabel">Run All</span>
                <span class="miRight" aria-hidden="true">
                  <span class="miHint defaultBadge">Default</span>
                  <span class="material-icons miCheck">done</span>
                </span>
              </button>

              <button class="menuItem" id="runSelBtn" type="button" role="menuitem">
                <span class="material-icons" aria-hidden="true">select_all</span>
                <span class="miLabel">Run Selection</span>
                <span class="miRight" aria-hidden="true">
                  <span class="miHint defaultBadge">Default</span>
                  <span class="material-icons miCheck">done</span>
                </span>
              </button>

              <button class="menuItem" id="runCellBtn" type="button" role="menuitem">
                <span class="material-icons" aria-hidden="true">view_agenda</span>
                <span class="miLabel">Run Cell</span>
                <span class="miRight" aria-hidden="true">
                  <span class="miHint defaultBadge">Default</span>
                  <span class="material-icons miCheck">done</span>
                </span>
              </button>
            </div>
          </div>

          <button class="toolBtn collapse" id="openBtn" type="button" title="Open (Cmd/Ctrl + O)" aria-label="Open file">
            <span class="material-icons" aria-hidden="true">folder_open</span>
            <span class="toolLabel">Open</span>
            <span class="hintPill" id="hintOpen">⌘ O</span>
          </button>

          <button class="toolBtn collapse" id="saveBtn" type="button" title="Save (Cmd/Ctrl + S)" aria-label="Save file">
            <span class="material-icons" aria-hidden="true">save</span>
            <span class="toolLabel">Save</span>
            <span class="hintPill" id="hintSave">⌘ S</span>
          </button>

          <button class="toolBtn collapse" id="shareBtn" type="button" title="Share link" aria-label="Share link">
            <span class="material-icons" aria-hidden="true">share</span>
            <span class="toolLabel">Share</span>
            <span class="hintPill">Link</span>
          </button>

          <div class="menuWrap">
            <button class="toolBtn collapse" id="moreBtn" type="button" aria-haspopup="menu" aria-expanded="false" title="More">
              <span class="material-icons" aria-hidden="true">more_horiz</span>
              <span class="toolLabel">More</span>
            </button>

            <div class="menu" id="moreMenu" role="menu" aria-label="More actions">
              <button class="menuItem" id="settingsBtn" type="button" role="menuitem">
                <span class="material-icons" aria-hidden="true">tune</span>
                <span class="miLabel">Settings</span>
                <span class="miHint" id="hintSettings">⌘ ,</span>
              </button>

              <button class="menuItem" id="resetBtn" type="button" role="menuitem">
                <span class="material-icons" aria-hidden="true">restart_alt</span>
                <span class="miLabel">Reset Pyodide</span>
              </button>

              <button class="menuItem" id="printBtn" type="button" role="menuitem">
                <span class="material-icons" aria-hidden="true">print</span>
                <span class="miLabel">Print / Export</span>
                <span class="miHint" id="hintPrint">⌘ P</span>
              </button>

              <button class="menuItem" id="shareMenuBtn" type="button" role="menuitem">
                <span class="material-icons" aria-hidden="true">share</span>
                <span class="miLabel">Share link</span>
                <span class="miHint">URL</span>
              </button>

              <button class="menuItem" id="aboutBtn" type="button" role="menuitem">
                <span class="material-icons" aria-hidden="true">info_outline</span>
                <span class="miLabel">About</span>
              </button>
            </div>
          </div>

          <input type="file" id="fileInput" style="display:none;" accept=".py,.txt"/>
        </div>
      </div>
    </header>

    <div class="isolationBanner" id="isolationBanner" role="status" aria-live="polite">
      <div class="isolationBannerInner">
        <span class="material-icons" aria-hidden="true">warning</span>
        <div class="isolationBannerText">
          <strong>Blocking input disabled.</strong>
          <span>Enable COOP/COEP headers to use <code>input()</code> and <code>time.sleep()</code>.</span>
        </div>
        <button class="iconBtn" id="isolationBannerClose" type="button" aria-label="Dismiss warning">
          <span class="material-icons" aria-hidden="true">close</span>
        </button>
      </div>
    </div>

    <main>
      <div class="split">
        <section class="pane editorPane" id="editorPane">
          <div class="paneHeader">
            <div class="paneLeft">
              <div class="paneTitle"><span class="dot"></span>Editor</div>
              <div class="paneMeta" id="fileMeta">untitled.py</div>
            </div>
            <div class="paneActions">
              <button class="iconBtn" id="wrapBtn" type="button" title="Toggle line wrap">
                <span class="material-icons" aria-hidden="true">wrap_text</span>
              </button>
            </div>
          </div>
          <textarea id="editor">print("Hello, World!")</textarea>
        </section>

        <div class="resizer" id="dragbar" aria-label="Resize panels"></div>

        <section class="pane consolePane" id="consolePane">
          <div class="paneHeader">
            <div class="paneLeft">
              <div class="paneTitle"><span class="dot"></span>Console</div>
            </div>
            <div class="paneActions">
              <button class="iconBtn danger" id="clearConsoleBtn" type="button" title="Clear console (Undo for 3s)">
                <span class="material-icons" aria-hidden="true">delete</span>
              </button>
              <button class="iconBtn undo" id="undoClearBtn" type="button" title="Undo clear" style="display:none;">
                <span class="material-icons" aria-hidden="true">undo</span>
              </button>
            </div>
          </div>
          <div id="console" role="log" aria-live="polite"></div>
        </section>
      </div>
    </main>

    <footer class="statusbar">
      <div class="sbLeft">
        <span class="sbItem good" id="sbRun"><span class="sbDot"></span><strong>Ready</strong></span>
        <span class="sbItem good" id="sbDirty"><span class="sbDot"></span><strong>Saved</strong></span>
        <span class="sbItem bad" id="sbPy"><span class="sbDot"></span><strong>Pyodide: not loaded</strong></span>
      </div>

      <div class="sbRight">
        <span class="sbItem"><strong class="sbMono" id="sbFile">untitled.py</strong></span>
        <span class="sbItem"><strong class="sbMono" id="sbPos">Ln 1, Col 1</strong></span>
        <span class="sbItem"><strong class="sbMono" id="sbSel">Sel 0</strong></span>
        <span class="sbItem"><strong class="sbMono" id="sbClock">--:--:--</strong></span>
      </div>
    </footer>
  </div>

  <div class="toast" id="shareToast" role="status" aria-live="polite">
    <span class="material-icons" id="shareToastIcon" aria-hidden="true">check_circle</span>
    <div class="toastText">
      <div class="toastTitle" id="shareToastTitle">Shared code loaded</div>
      <div class="toastDesc" id="shareToastDesc">This editor opened code from a share link.</div>
    </div>
  </div>

  <!-- About modal -->
  <div class="overlay" id="aboutOverlay" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
    <div class="modal modalAbout">
      <h2 id="aboutTitle">Inscribe Editor <span class="versionTag" id="aboutVersion">v3.1</span></h2>
      <p>A lightweight in-browser Python editor and executor using Pyodide.</p>
      <div class="aboutMeta">
        <div class="aboutMetaRow">
          <span class="aboutMetaLabel">Build time</span>
          <span class="aboutMetaValue" id="aboutBuildTime">unknown</span>
        </div>
        <div class="aboutMetaRow">
          <span class="aboutMetaLabel">Commit</span>
          <span class="aboutMetaValue aboutMetaCode" id="aboutCommitHash">unknown</span>
        </div>
      </div>
      <p>
        This software is provided “as is”, without warranty of any kind.<br/>
        Licensed under the MIT License.
      </p>
      <p style="color: rgba(15,23,42,0.70);">
        Copyright © 2023–2026 Mark Yu.
      </p>

      <div class="modalRow">
        <button class="toolBtn" id="closeAboutBtn" type="button">Close</button>
        <a class="toolBtn primary" href="https://github.com/mkyyu/python-web-ide" target="_blank" rel="noreferrer">
          <span class="material-icons" aria-hidden="true">open_in_new</span>
          <span style="opacity:1;transform:none;">View source</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Settings modal -->
  <div class="overlay" id="settingsOverlay" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="modal modalSettings">
      <div class="settingsHeader">
        <div>
          <h2 id="settingsTitle">Settings</h2>
          <p class="settingsIntro">Quiet controls that improve long-session comfort. Stored locally in your browser.</p>
        </div>
      </div>

      <div class="settingsGrid">
        <section class="settingsCard" aria-label="Preferences">
          <div class="settingsCardTitle">Preferences</div>

          <div class="settingsSection">
            <div class="settingsSectionTitle">Font sizes</div>
            <div class="settingsRow">
              <label class="settingsLabel" for="editorSizeRange">Editor size</label>
              <div class="settingsControl settingsRange">
                <input id="editorSizeRange" type="range" min="12" max="18" step="0.25" />
                <span class="settingsValue" id="editorSizeLabel">14.00px</span>
              </div>
            </div>
            <div class="settingsRow">
              <label class="settingsLabel" for="consoleSizeRange">Console size</label>
              <div class="settingsControl settingsRange">
                <input id="consoleSizeRange" type="range" min="12" max="18" step="0.25" />
                <span class="settingsValue" id="consoleSizeLabel">13.50px</span>
              </div>
            </div>
          </div>

          <div class="settingsSection">
            <div class="settingsSectionTitle">Editor behavior</div>
            <div class="settingsRow">
              <label class="settingsLabel toggle" for="wrapToggle">
                <input id="wrapToggle" type="checkbox" />
                <span>Line wrap</span>
              </label>
            </div>
            <div class="settingsNote">Wrap long lines to stay within the editor width.</div>
          </div>

          <div class="settingsSection">
            <div class="settingsSectionTitle">Runtime</div>
            <div class="settingsRow">
              <label class="settingsLabel toggle" for="execTimeToggle">
                <input id="execTimeToggle" type="checkbox" />
                <span>Show execution time</span>
              </label>
            </div>
            <div class="settingsNote">Adds a "Finished in ..." line after runs.</div>
          </div>
        </section>

        <section class="settingsCard" aria-label="Shortcuts">
          <div class="settingsCardTitle">Shortcuts</div>
          <table class="shortcuts" aria-label="Keyboard shortcuts">
            <tbody id="shortcutBody"></tbody>
          </table>
        </section>
      </div>

      <div class="modalRow">
        <button class="toolBtn" id="closeSettingsBtn" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- Print / Export modal -->
  <div class="overlay" id="printOverlay" role="dialog" aria-modal="true" aria-labelledby="printTitle">
    <div class="modal modalSettings">
      <div class="settingsHeader">
        <div>
          <h2 id="printTitle">Print / Export</h2>
          <p class="settingsIntro">Prepare a clean export of your code and output.</p>
        </div>
      </div>

      <div class="settingsGrid">
        <section class="settingsCard" aria-label="Content selection">
          <div class="settingsCardTitle">Content</div>
          <div class="settingsSection">
            <div class="settingsRow">
              <label class="settingsLabel toggle" for="printIncludeCode">
                <input id="printIncludeCode" type="checkbox" />
                <span>Code</span>
              </label>
              <label class="settingsLabel toggle" for="printIncludeOutput">
                <input id="printIncludeOutput" type="checkbox" />
                <span>Output</span>
              </label>
            </div>
            <div class="settingsNote" id="printContentNote">Select at least one item to print.</div>
          </div>
        </section>

        <section class="settingsCard" aria-label="Layout options">
          <div class="settingsCardTitle">Layout</div>
          <div class="settingsSection">
            <div class="settingsRow">
              <label class="settingsLabel toggle" for="printLineNumbers">
                <input id="printLineNumbers" type="checkbox" />
                <span>Show line numbers</span>
              </label>
              <label class="settingsLabel toggle" for="printWrapLines">
                <input id="printWrapLines" type="checkbox" />
                <span>Wrap long lines</span>
              </label>
            </div>
          </div>
        </section>

        <section class="settingsCard" aria-label="Metadata inclusion">
          <div class="settingsCardTitle">Metadata</div>
          <div class="settingsSection">
            <div class="settingsRow">
              <label class="settingsLabel toggle" for="printBranding">
                <input id="printBranding" type="checkbox" />
                <span>Include branding</span>
              </label>
              <label class="settingsLabel toggle" for="printTimestamp">
                <input id="printTimestamp" type="checkbox" />
                <span>Include timestamp</span>
              </label>
            </div>
          </div>
        </section>

      </div>

      <div class="modalRow">
        <button class="toolBtn" id="printCancelBtn" type="button">Cancel</button>
        <button class="toolBtn primary" id="printConfirmBtn" type="button">Print / Export</button>
      </div>
    </div>
  </div>

  <div class="exportRoot" id="exportRoot" aria-hidden="true"></div>

  <!-- Long URL warning modal -->
  <div class="overlay" id="shareWarnOverlay" role="dialog" aria-modal="true" aria-labelledby="shareWarnTitle">
    <div class="modal modalSettings">
      <div class="warnBlock">
        <span class="material-icons" aria-hidden="true">warning</span>
        <div>
          <h2 id="shareWarnTitle">Share Link Warning</h2>
          <div class="warnText" id="shareWarnText">This link is long. Continue anyway?</div>
          <div class="warnHint">Tip: download a .py file instead to avoid very long URLs.</div>
        </div>
      </div>

      <div class="modalRow">
        <button class="toolBtn" id="shareWarnCancelBtn" type="button">Cancel</button>
        <button class="toolBtn" id="shareWarnDownloadBtn" type="button">Download .py</button>
        <button class="toolBtn primary" id="shareWarnConfirmBtn" type="button">Copy anyway</button>
      </div>
    </div>
  </div>

  <!-- Asyncio.run warning modal -->
  <div class="overlay" id="asyncWarnOverlay" role="dialog" aria-modal="true" aria-labelledby="asyncWarnTitle">
    <div class="modal modalSettings">
      <div class="warnBlock">
        <span class="material-icons" aria-hidden="true">warning</span>
        <div>
          <h2 id="asyncWarnTitle">Asyncio Run Warning</h2>
          <div class="warnText" id="asyncWarnText">
            This environment already runs an event loop. Use <code>await main()</code> instead of
            <code>asyncio.run(main())</code>.
          </div>
          <div class="warnHint">Continuing will likely throw “cannot be called from a running event loop”.</div>
        </div>
      </div>

      <div class="modalRow">
        <button class="toolBtn" id="asyncWarnCancelBtn" type="button">Cancel</button>
        <button class="toolBtn primary" id="asyncWarnConfirmBtn" type="button">Run anyway</button>
      </div>
    </div>
  </div>

<script type="module" src="dist/main.js" defer></script>
</body>
</html>
